var portals = [[0, 0, 0, 1, 4, [1, 0, 5, 0]],

           [0, 1, 1, 4, 1, [1, 1,    7, 1]],
           [0, 1, 1, 6, 1, [1, 1,    6, 2]],
           [0, 1, 1, 8, 1, [1, 1,    8, 2]],

           [0, 1, 1, 4, 3, [1, 1,    7, 3]],
           [0, 1, 1, 6, 3, [1, 1,    6, 4]],
           [0, 1, 1, 8, 3, [1, 1,    8, 4]],

           [0, 1, 1, 4, 5, [1, 1,    7, 5]],
           [0, 1, 1, 6, 5, [1, 1,    6, 6]],
           [0, 1, 1, 8, 5, [1, 1,    8, 6]],

           [0, 1, 1, 4, 7, [1, 1,    7, 7]],
           [0, 1, 1, 6, 7, [1, 1,    6, 8]],
           [0, 1, 1, 8, 7, [1, 1,    8, 8]],



           [0, 1, 1, 3, 2, [1, 1,    3, 1]],
           [0, 1, 1, 5, 2, [1, 1,    5, 1]],
           [0, 1, 1, 7, 2, [1, 1,    4, 2]],

           [0, 1, 1, 3, 4, [1, 1,    3, 3]],
           [0, 1, 1, 5, 4, [1, 1,    5, 3]],
           [0, 1, 1, 7, 4, [1, 1,    4, 4]],

           [0, 1, 1, 3, 6, [1, 1,    3, 5]],
           [0, 1, 1, 5, 6, [1, 1,    2, 6]],
           [0, 1, 1, 7, 6, [1, 1,    4, 6]],

           [0, 1, 1, 3, 8, [1, 1,    3, 7]],
           [0, 1, 1, 5, 8, [1, 1,    5, 7]],
           [0, 1, 1, 7, 8, [1, 1,    4, 8]],

           [0, 0, 0, 0, 5, [0, 0,    5, 1]],
           [0, 0, 1, 8, 0, [2, 0,    5, 1]]]


var map00 = [[[1], [0], [1], [1], [1], [0], [1], [1], [1], [1]],
         [[1], [0], [1], [0], [0], [0, 3], [1], [0], [0], [1]],
         [[1], [0], [1], [0], [1], [0], [1], [0], [0], [1]],
         [[1], [0, 3], [1], [0], [1], [0], [0], [0], [0], [1]],
         [[1], [0, 2], [1], [0], [1], [1], [1], [0], [0], [1]],
         [[1], [0, 2], [0, 4], [0], [0], [0], [1], [0], [0], [0]],
         [[1], [1], [1], [1], [1], [0, 4], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [1], [0], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [1], [0], [0], [0], [0], [0, 4]],
         [[1], [0], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map01 = [[[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0, 3], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [1], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [0], [0], [1], [1], [1], [1]]]

var map10 = [[[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [1], [1], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [1], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [1], [1], [1], [1], [1], [0], [1]],
         [[0], [0], [0], [1], [0], [0], [0], [1], [0], [1]],
         [[0], [0], [0, 5], [0], [0], [1], [0], [0], [0], [0, 4]],
         [[0], [0], [0], [1], [1], [1], [1], [1], [0], [1]],
         [[0], [0], [0], [1], [0], [0], [0], [0], [0], [0]],
         [[1], [1], [1], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0, 3], [0]]]

var map11 = [[[1], [1], [1], [1], [0, 4], [1], [1], [1], [1], [1]],
         [[1], [0, 3], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [0], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map20 = [[[1], [0], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map21 = [[[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map02 = [[[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map12 = [[[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map22 = [[[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[0], [0], [0], [0], [0], [0], [0], [0], [0], [0]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [0], [0], [0], [0], [0], [0], [0], [0], [1]],
         [[1], [1], [1], [1], [1], [1], [1], [1], [1], [1]]]

var map_ = [[map00, map01, map02],
        [map10, map11, map12],
        [map20, map21, map22]]
var map_rows = 3
var map_cols = 2
var cell_rows = 10
var cell_cols = 10
var square_size = 50

var img_names = ['grass', 'wall', 'cherry', 'portal', 'bullet_case']
var images = {}
for (var i = 0; i < img_names.length; i++) {
    var img = new Image()
    img.src = "img/" + img_names[i] + ".png"
    images[img_names[i]] = img
}
//var ground_images = {'grass': pygame.image.load("images/grass.png")}
//var barrier_images = {'wall': pygame.image.load("images/wall.png")}
//var food_images = {'cherry': pygame.image.load("images/cherry.png")}
//var portal_images = {'portal': pygame.image.load("images/portal.png")}
var door_colors = {'red_door': 'red', 'blue_door': 'blue'}
var key_colors = {'red_key': 'red', 'blue_key': 'blue'}
//var bullet_case_images = {'bullet_case': pygame.image.load("images/bullet_case.PNG")}


function build_map(map_all) {
    var map_result = []
    for (var mr = 0; mr < map_rows; mr++) {
        map_result.push([])
        for (var mc = 0; mc <map_cols; mc++) {
            map_result[mr].push([])
            for (var cr = 0; cr < cell_rows; cr++) {
                map_result[mr][mc].push([])
                for (var cc = 0; cc < cell_cols; cc++) {
                    map_result[mr][mc][cr].push([])
                    for (let el of map_all[mr][mc][cr][cc]) {
                        if (el == 0) {
                            var obj = new Ground('grass', images['grass'], cc*square_size, cr*square_size)
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                        else if (el == 1) {
                            var obj = new Barrier('wall', images['wall'], cc * square_size, cr * square_size)
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                        else if (el == 2) {
                            var obj = new Food('cherry', images['cherry'], cc*square_size, cr*square_size)
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                        else if (el == 3) {
                            var x = Math.floor(cc*square_size + square_size/2) - 5
                            var y = Math.floor(cr*square_size + square_size/2) - 5
                            var w = Math.floor(square_size/5)
                            var h = Math.floor(square_size/5)
                            var obj = new Key('red_key', key_colors['red_key'], [x, y, w, h])
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                        else if (el == 4) {
                            var obj = new Door('red_door', door_colors['red_door'],
                                       [cc*square_size, cr*square_size, square_size, square_size])
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                        else if (el == 5) {
                            var obj = new BulletCase('bullet_case', images['bullet_case'],
                                             cc * square_size, cr * square_size)
                            map_result[mr][mc][cr][cc].push(obj)
                        }
                    }
                }
            }
        }
    }

    for (let portal of portals) {
        var [portal_img, mr, mc, cr, cc, dest] = portal
        var portal_obj_img = images['portal']
        var portal_obj_x = cc * square_size
        var portal_obj_y = cr * square_size
        var portal_obj_dest = dest
        var portal_obj = new Portal(portal_obj_img, portal_obj_x, portal_obj_y, portal_obj_dest)
        map_result[mr][mc][cr][cc].push(portal_obj)
    }

    return map_result
}

